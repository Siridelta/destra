# 技术设计笔记 - 251003

> 本文档记录了 Bernard 项目在 2025 年 10 月 3 日进行的关键设计决策，核心内容是确立了“默认模式”与“Genshin模式”的双轨制开发策略。

## 背景

随着对 Desmos 系统的深入研究和 Bernard 项目开发的推进，我们遇到了一个核心的设计哲学冲突：

-   **方向一：框架化与易用性**。将 Bernard 设计成一个高度封装、专注于表达式组合与复用的工具框架。这要求我们对 Desmos 的原生行为进行一定的简化和约束（如禁止悬空依赖），以提供更稳定、更易于理解的顶层 API。这个方向有利于快速开发和项目工程化。
-   **方向二：灵活性与完整性**。将 Bernard 打造成一个能精细操作 Desmos 表达式对象的底层工具集，完整复现 Desmos 的所有特性，包括其高级、灵活甚至有些“黑科技”的机制（如强制替换、事后补全定义等）。这个方向能满足社区深度玩家的需求，但会大大增加顶层框架的设计难度。

## 决策：确立双轨制开发策略

为了解决上述冲突，并为项目提供清晰的前进路径，我们决定采取**双轨制开发策略**，将项目明确划分为两种模式：

### 1. 默认模式 (Default Mode)
- **定位**: 项目**当前阶段的主要开发方向**和**推荐使用方式**。
- **目标**: 成为一个易于使用的、专注于封装和复用的**高级框架**。
- **核心约束**:
    - 禁止悬空依赖。
    - 统一上下文语句行为为“弱绑定”，禁止强制替换。
    - 优先实现命名、封装等核心工程化特性。
- **意义**: 使我们能够快速迭代，优先满足广大用户构建复杂、可维护图表的核心需求。

### 2. Genshin 模式
- **定位**: 项目的**长期探索性方向**。
- **目标**: 成为一个能够完整建模 Desmos 所有底层机制的**低级工具集**。
- **核心特性**:
    - 支持悬空依赖、强上下文绑定等高级特性。
    - 探索盲文模式等边界功能。
- **意义**: 为社区“黑科技”开发者保留了可能性，是项目深度的体现，但**目前处于概念规划阶段，暂不投入开发资源**。

## 下一步

项目的近期开发工作将完全围绕**默认模式**展开。相关的技术设计已在 [JS技术方案.md](../JS路线/JS技术方案.md) 中进行了详细阐述。
