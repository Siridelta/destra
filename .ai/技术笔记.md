# Bernard.jl 技术笔记

> 本文件记录 Bernard 库的技术相关的总体信息；关于各方面详细信息请参考其他对应文档。
> 可以参考我们的一份关于 Desmos 建模的文档：`.ai/Desmos建模/公式系统.md`。

## 项目愿景与核心目标

Bernard 致力于为 Desmos 图形计算器爱好者提供一个编程化构建和管理复杂图表的框架；

Bernard 让用户可以通过编程方式管理大量表达式，克服 Desmos 原生界面在处理复杂图表时的局限性；

Bernard 提供自然的数学表达、依赖管理、实时反馈、可程序化操作等能力。

## 技术路线与选型原则

技术路线为 Julia 和 JS。

选型原则：优先考虑数学表达自然、操作轻松、元编程能力强、科学计算生态丰富的语言。

Julia 路线中，关于表达式建模有两个方案：

- 使用 Symbolics.jl（符号计算库，优点是复用现有能力，缺点是需适配 Desmos 特性）

- 自建对象系统（优点是完全定制，缺点是开发量大）

具体实现细节请见 Julia 路线技术方案文档。

关于JS路线，？？？？？？

## 技术性背景信息

Desmos 图表有三层表示：

  1. Desmos 内部表示（不可见）
  
  2. Desmos State JSON --- 序列化格式，输出目标；它
  
  3. Bernard.jl 对象模型（核心建模层）
  
架构目标：实现表达式、公式、图表的分层建模，支持依赖追踪和属性管理。

- 表达式对象：变量引用、函数调用、运算表达式等

- 公式对象：一行 Desmos 公式，含表达式内容、类型、绘图属性、滑动条属性等

- 图表对象：完整 Desmos 图表，含公式列表、依赖图、全局设置

- 具体类型定义和实现请见 Julia 路线技术方案文档。

## 依赖管理基本思路
- 自动识别表达式中的变量和函数引用
- 构建公式间依赖关系的有向图
- 检查循环依赖和命名冲突
- 支持变量内联和表达式简化
- 具体依赖管理实现请见 Julia 路线技术方案文档。

## 开发体验优化
- 热重载：代码更改后自动重新编译和更新预览
- 增量更新：只重新计算受影响的表达式
- 代码生成：支持从 Desmos 状态反向生成 Bernard.jl 代码

## 主要技术难点与解决思路
- 性能：Julia 启动慢，可用 PackageCompiler 优化
- 前后端集成：需设计清晰的 JSON API，支持 WebSocket 实时通信
- 部署：建议提供 Docker 配置和详细部署指南
- 具体优化细节请见 Julia 路线技术方案文档。

## 未来发展方向、开放问题
- 扩展自定义绘图函数、动画序列、模板库等
- 持续完善 Desmos 机制建模和对象系统设计
- 记录和跟踪待研究问题、技术难点
