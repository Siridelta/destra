# Bernard 项目总览

> Bernard 是一个为 Desmos 图形计算器爱好者设计的编程框架，让用户能够通过代码来构建和管理复杂的数学图表。

## 项目背景

Desmos 是一个强大的数学可视化平台，但在处理复杂图表时，其原生界面存在一些局限性。当我们需要管理大量表达式、处理复杂的依赖关系，或者需要程序化地生成图表时，手动操作变得非常繁琐。

Bernard 正是为了解决这些问题而生。它提供了一个编程化的框架，让用户能够用代码方便地构建 Desmos 图表，同时保持数学表达的自然性和直观性。

另外，Bernard 计划与 Desmos Canvas 项目深度集成，将 Desmos 图表创作引入画布式编程环境。Desmos Canvas 是一个画布式的编程环境，探索画布式、交互式、声明式创作工具的开发，为 Bernard 提供了全新的使用方式，让更多 Desmos 爱好者能够通过直观的图形界面来使用 Bernard 的功能。

### Desmos Canvas 项目背景

Desmos Canvas 项目起步于对更大项目（Para/Parasee）愿景的探索，采用 AI 协作开发、快速原型验证的技术路线。项目已经完成了基础画布系统、交互式控件、实时执行等核心功能，并确认采用 React 19.0 + TypeScript + Vite + React Flow + TailwindCSS + Zustand 的技术栈。

### 集成愿景

通过 Bernard 与 Desmos Canvas 的集成，创作者可以在画布中编写代码并实时预览 Desmos 图表，从面向编程用户扩展到更广泛的可视化创作群体。这种集成将实现：

- **画布式编程体验** - 在画布上创建和编辑代码块，支持拖拽、缩放等操作
- **交互式数学创作** - 通过滑动条、输入框等控件调整数学参数，实现实时调节
- **声明式/响应式创作** - 数据变更自动同步到所有依赖元素，减少重复劳动
- **Desmos 无缝预览** - 代码修改后立即在 Desmos 中查看效果

## 核心愿景

我们希望通过 Bernard 实现以下目标：

**让数学创作更自然** - 提供接近数学表达习惯的语法，让创作者能够直观地编写表达式，而不需要适应复杂的编程语法。

**简化复杂图表的构建** - 通过编程方式管理大量表达式，自动处理依赖关系，避免手动操作中的错误和重复工作。

**提供强大的扩展能力** - 支持可扩展的公式组合，让用户能够构建可重用的数学组件和模板。

**实现实时反馈** - 提供高效的开发体验，表达式修改后能立即在预览中查看效果，形成快速迭代的创作循环。

## 技术路线演进

### 技术选择历程

在 Bernard 和 Desmos Canvas 两个项目的开发过程中，我们同时考虑了两个技术路线：Julia 和 JavaScript。这个选择需要从两个项目的整体视角来评估。

**Julia 路线的优势**：
- **数学表达自然** - Julia 的语法极其接近数学表达习惯，支持隐式乘法、Unicode 数学符号等
- **元编程能力强** - 通过宏系统可以捕获和处理表达式，提供强大的代码生成能力
- **科学计算生态丰富** - 有成熟的符号计算库和数学工具链

**JavaScript 路线的优势**：
- **前后端开发生态丰富** - 有成熟的前端框架、工具链和社区支持
- **易学易用** - 对大多数开发者而言更熟悉，学习成本较低
- **架构简化** - Desmos Canvas 可以采取更简单的无后端架构
- **部署便利** - 纯前端应用部署简单，用户可以直接在浏览器中使用

### 架构影响分析

**Desmos Canvas 的架构选择**：
- **JavaScript 路线**：可以采取无后端架构，前端直接处理所有逻辑
- **Julia 路线**：必须开发 Julia 后端，并将前端打包成 Tauri 应用

**Bernard 的使用体验**：
Bernard 的使用体验受两个方面影响：
- **表达式创建的语法简洁程度** - Julia 在前者所能支持的语法设计方案一定程度上胜过 JavaScript 里的方案
- **对表达式对象进行自定义程序化操作的难易程度** - 对于后者，编程化处理，JavaScript 可能比 Julia 好很多

### 最终决策

经过综合考虑，我们选择在这两个项目中首先进行 JavaScript 路线的开发，Julia 作为第二选项，有机会也会开发。这个选择既考虑了技术优势，也考虑了开发效率和项目协同的需求。

### 技术架构设计
> note: this is not exact, later edit
Bernard 采用分层架构设计，主要包括以下几个核心层次：

**表达式层** - 处理数学表达式的建模和操作，包括变量引用、函数调用、运算表达式等基本元素。

**公式层** - 管理完整的 Desmos 公式，包含表达式内容、类型、绘图属性、滑动条属性等所有相关信息。

**图表层** - 组织完整的 Desmos 图表，管理公式列表、依赖关系图、全局设置等。

**依赖管理层** - 自动识别和处理表达式之间的依赖关系，构建依赖图，检查循环依赖和命名冲突。

## 项目结构

```
项目根目录/
├── Bernard.js/           # JavaScript 核心实现
│   ├── src/              # 核心库源码
│   ├── examples/         # 使用示例
│   ├── test/             # 测试代码
│   └── package.json      # 项目配置
├── Bernard.jl/           # Julia 路线（历史版本）
├── .ai/                  # AI 协作文档库
├── .ai new/              # 新的文档结构
└── README.md             # 项目介绍
```

## 开发状态

目前项目处于重新规划和文档重构阶段。我们正在：

1. **更新技术文档** - 重写核心文档，明确 JS 优先的技术路线
2. **完善设计文档** - 详细设计 JavaScript 环境下的架构和实现方案
3. **建立开发流程** - 制定与 Desmos Canvas 协同发展的开发计划

## 开发者

- static
- creepebucket

> 注：static 和 creepebucket 共用一个 Cursor 账号。

## 常见问题

**Q: Bernard 与 Desmos 官方 API 有什么区别？**

A: Bernard 是一个社区项目，不是 Desmos 官方产品。它提供了一个编程框架来构建 Desmos 图表，而 Desmos 官方 API 主要是为了在网页中嵌入 Desmos 计算器。Bernard 更专注于提供编程化的图表构建能力。

**Q: 为什么选择 JavaScript 而不是 Julia？**

A: 虽然 Julia 在数学表达方面有天然优势，但考虑到与 Desmos Canvas 项目的协同发展需求，以及前端生态的成熟度，JavaScript 在当前阶段是更合适的选择。我们保留了 Julia 路线的探索，作为未来的备选方案。

**Q: Bernard 如何处理复杂的数学表达式？**

A: Bernard 设计了专门的表达式建模系统，支持变量引用、函数调用、运算表达式等基本元素，并提供依赖关系管理，确保表达式之间的逻辑一致性。

**Q: 项目的当前主要挑战是什么？**

A: 当前主要挑战包括：完善 JavaScript 环境下的表达式建模、设计与 Desmos Canvas 的集成方案、建立高效的开发体验等。 
