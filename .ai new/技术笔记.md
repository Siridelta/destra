# Bernard 技术笔记

> 本文档概述 Bernard 项目的核心技术思路和实现方案，详细的技术文档请参考对应的专项文档。

## 技术背景

### Desmos 图表的三层表示

Desmos 图表在技术实现上分为三个层次：

**Desmos 内部表示** - 这是 Desmos 计算器内部使用的数据结构，我们无法直接访问，但需要理解其工作原理来设计我们的建模系统。

**Desmos State JSON** - 这是 Desmos 图表的序列化格式，也是我们最终需要生成的目标格式。它包含了图表的所有信息，包括表达式、样式、设置等。

**Bernard 对象模型** - 这是我们设计的核心建模层，用于在编程环境中表示和管理 Desmos 图表。这个模型需要能够方便地转换为 Desmos State JSON，同时提供丰富的编程接口。

### 核心设计原则

在设计 Bernard 的对象模型时，我们遵循以下几个核心原则：

**数学表达的自然性** - 创作者应该能够用接近数学习惯的方式来表达公式，而不需要适应复杂的编程语法。

**依赖关系的透明性** - 系统应该能够自动识别和处理表达式之间的依赖关系，让创作者专注于数学逻辑而不是技术细节。

**扩展性和组合性** - 支持公式的组合和重用，让创作者能够构建复杂的数学组件。

## 技术路线概述

### JavaScript 技术方案

Bernard 采用 JavaScript 作为主要技术路线，设计了双重表达式对象模式：

- **expr** - 纯表达式节点，用于表示数学表达式
- **expl** - 显式公式节点，用于定义变量和函数

这个设计通过两种不同的声明方式区分不同类型的节点，利用 JavaScript 的模板字符串作为 DSL 载体。

详细的技术实现方案请参考 [JavaScript 技术方案](./JS技术方案.md)。

### 与 Desmos Canvas 的集成

Bernard 与 Desmos Canvas 项目深度集成，提供画布式的编程体验。集成方案包括：

- **画布集成** - 在画布中创建 Bernard 节点
- **实时预览** - 代码修改后立即在 Desmos 中查看效果
- **协作编辑** - 支持多用户实时协作编辑

详细的集成方案请参考 [Desmos Canvas 集成方案](./DesmosCanvas集成方案.md)。

## 核心功能模块

### 表达式建模

Bernard 采用对象化的方式来表示数学表达式，支持变量引用、函数调用、运算表达式等基本元素。详细的设计方案请参考 [表达式建模设计](./表达式建模设计.md)。

### 依赖管理系统

系统能够自动识别和处理表达式之间的依赖关系，构建依赖图，检查循环依赖和命名冲突。详细实现请参考 [依赖管理系统](./依赖管理系统.md)。

### 开发体验优化

Bernard 提供多种开发体验优化功能：

- **实时预览** - 通过 WebSocket 或轮询机制实现实时预览
- **热重载支持** - 在开发模式下支持代码更改后的自动重新编译
- **增量更新** - 只重新计算受影响的表达式，提高性能

详细实现请参考 [开发体验优化](./开发体验优化.md)。

## 性能优化策略

### 表达式缓存

缓存已计算的表达式结果，避免重复计算。

### 懒加载

只在需要时加载和计算表达式，提高系统响应速度。

详细的性能优化策略请参考 [性能优化策略](./性能优化策略.md)。

## 技术文档索引

### 核心技术文档
- [JavaScript 技术方案](./JS路线/JS技术方案.md) - JavaScript 路线的详细技术设计

### 待创建的技术文档
- [表达式建模设计](./JS路线/表达式建模设计.md) - 数学表达式的建模方案（待创建）
- [依赖管理系统](./JS路线/依赖管理系统.md) - 依赖关系的识别和管理（待创建）
- [开发体验优化](./JS路线/开发体验优化.md) - 开发体验的优化策略（待创建）
- [Desmos Canvas 集成方案](./JS路线/DesmosCanvas集成方案.md) - 与 Desmos Canvas 的集成方案（待创建）
- [性能优化策略](./JS路线/性能优化策略.md) - 系统性能优化策略（待创建）

## 未来发展方向

### 扩展功能

- **自定义绘图函数** - 支持创作者定义自己的绘图函数
- **动画序列** - 支持创建复杂的动画效果
- **模板库** - 提供常用的数学图表模板

### 技术改进

- **性能优化** - 进一步优化大规模图表的性能
- **错误处理** - 完善错误检测和提示机制
- **文档系统** - 提供更好的文档和示例

### 生态系统

- **插件系统** - 支持第三方插件扩展
- **社区贡献** - 建立社区贡献机制
- **标准化** - 推动相关标准的制定 