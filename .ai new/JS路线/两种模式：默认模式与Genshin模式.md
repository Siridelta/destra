# 两种模式：默认模式与 Genshin 模式

本文档阐述 Bernard 项目的核心设计哲学，即“默认模式”与“Genshin模式”的双轨制策略。这一划分旨在平衡快速开发、框架易用性与保留 Desmos 底层操作的灵活性之间的关系。

## 模式一：默认模式 (Default Mode)

### 目标

**默认模式** 是 Bernard 库的主要开发方向和推荐使用方式。其核心目标是提供一个**高度封装、专注于表达式组合与复用的工具框架**。它旨在简化 Desmos 图表的构建过程，让用户可以像编写模块化代码一样来组织复杂的数学逻辑。

### 核心原则与取舍

为了实现上述目标，默认模式在设计上有明确的取舍，主动放弃了 Desmos 的部分原生特性，以换取更高级别的抽象和更强的工程确定性：

1.  **禁止悬空依赖**：所有表达式在定义时，其依赖必须已经明确存在。不允许引用一个尚未定义的符号，也不支持“先引用，后补全定义”的模式。这确保了依赖图的完整性和可预测性。

2.  **统一上下文语句行为**：所有上下文语句（包括 `with`, `for`）的行为都被统一为**弱上下文绑定**。它们只能用于“填补”其内容表达式中由该语句引入的局部变量，绝不能强制替换或覆盖上游已经存在的全局定义。

3.  **专注核心封装**：暂时放弃对 Desmos 中部分高级、边界或尚不明确的特性（如盲文模式）进行建模，将开发精力集中在命名、封装、模块化等核心功能上。

### 适用场景

适用于需要构建大型、复杂、可维护的 Desmos 图表的开发者，特别是那些希望将软件工程的最佳实践（如模块化、封装、代码复用）应用于数学可视化创作的场景。

## 模式二：Genshin 模式

### 目标

**Genshin模式**（命名源于社区玩笑，意指追求极致的“黑科技”玩法）代表了 Bernard 项目的探索性方向。其目标是提供一个能够从**各个细节深度操作 Desmos 表达式对象的底层工具集**。

### 核心特性

该模式将致力于完整建模 Desmos 的所有机制，保留其全部的灵活性和自由度，包括：

-   支持悬空依赖与“事后补全”定义。
-   完整实现强上下文绑定语句（`with`, `for`）的强制替换功能。
-   探索并支持盲文模式等高级特性。

### 当前状态

**Genshin模式** 目前处于**概念和远期规划阶段**。它的设计和实现难度远高于默认模式，并且其高度的灵活性可能会与默认模式的封装框架产生冲突。在默认模式成熟之前，不会作为开发重点。

## 当前策略：优先开发默认模式

鉴于项目当前的紧迫需求和技术可行性，我们将**集中全部精力优先开发和完善“默认模式”**。这能让我们以最快的速度交付一个稳定、可用、能解决核心问题的 Bernard 核心库。
