# 概述 (Overview)

本文档详尽列出了 Desmos 中的所有语法与内置函数，以及为之设计的 Destra 的 Expr DSL 的所有语法与内置函数。

Destra 的 Expr DSL 设计原则是 **"所见即所得" (WYSIWYG)** 与 **"原生兼容"**：
1.  **所见即所得**: 基本上，你在 Desmos 网页版的公式输入框里怎么敲击键盘，在 Expr DSL 字符串里就怎么写。
2.  **插值增强**: 在此基础上，我们利用 JS 模板字符串的 `${...}` 插值功能，实现了对 JavaScript 变量的引用和依赖管理。

## 前言

### Desmos / Destra 语法展示

本文档需要同时展示 Desmos 语法与 Destra Expr DSL 语法。

Destra 语法使用 JS 代码形式直接展示，如：

```javascript
expr`x^2 / ${a}^2 + y^2 / ${b}^2 = 1`
```

这样也可以直观展示编写 Destra 代码时从 JS 层到 DSL 语法内部层的全部使用细节（如插值等），而不完全局限于 Expr DSL 范围内。

关于 Desmos 语法，Desmos 内部的信息标准是 LaTeX 形式，但是在我们文档里全部用 LaTeX 形式展示的话会很大程度上增加阅读难度（我个人认为 LaTeX 语法本身对人类远不友好），因此我们会使用一种更加简便的临时语法来展示 Desmos 端原生的公式内容。这个简便语法也会应用在本项目知识库的所有文档中，所以说我们尽量“意会”即可。

上面的 Destra 代码在展示其对应的 Desmos 公式内容时，我们将这样展示：

```
x^2 / a^2 + y^2 / b^2 = 1
```

注意：使用内联 markdown 语法来展示 Destra 模板字面量语法时，需前后用2个(以上)反引号包裹，并且需要按需与代码内容用空格分隔，以避免代码内容中的反引号和 markdown 语法标记混淆。如：``expr`x^2 / ${a}^2 + y^2 / ${b}^2 = 1` ``

### 标识符与 DSL 内部变量引用

在其他相关文档里有所提及，但在这里再次说明一下：

DSL 中出现的任何非内置标识符，都会被视为 DSL 内部变量引用。

目前可以使用 DSL 内部变量名的场景包括：上下文变量名、显式方程的未定义变量写法的自变量/因变量、回归公式的回归参数。其他情况下都使用模板字面量插值 `${...}` 来引用。

DSL 内部变量名在编译时会自动转换为 Desmos 兼容格式。

关于 Expr DSL 的背景可参考 [JS路线](../../../../JS路线/index.md)。

关于 Destra 命名机制的细节可参考 [核心API与命名机制](../../../核心API与命名机制.md)。

### 公式类型与子类型

参考 [.ai/Desmos建模/03-公式类型与符号系统.md](../../../../../Desmos建模/03-公式类型与符号系统.md)。

在 Desmos 语言环境里，数据在一定程度上具有类型（动态类型）。但是并不是所有在 Desmos 中的数据类型都能在 Destra 的 JS/TS 类型系统里建模。Destra 的类/类型系统只能建模部分 Desmos 类型信息，这是技术上面临限制并权衡后的结果。

为了描述这种局限性，我们引入 “公式类型” 与 “公式子类型” 的概念。公式类型层是可被静态分析、而后被 Destra 类/类型系统建模的类型信息，而公式子类型基本上是一个公式类型内的子级划分，无法被静态分析。

例如，“表达式”公式类型(`Expression extends Expr extends Formula`)下有 “数值”、“点”、“列表” 等子类型。当然这些子类型也可以同时视为“变量定义”公式类型(`VarExpl extends Expl extends Formula`)的子类型。

但是，在解析 Expr DSL 内容时，可以将公式子类型与创建数据的字面量语法联系起来，因此下文会详细介绍各类公式子类型及其对应字面量语法。
