# 默认模式：简化的计算模型

> 本文档阐述 Destra “默认模式”为保证工程确定性而设定的两大核心约束：禁止悬空依赖，以及统一的弱绑定上下文模型。这两点是默认模式区别于 Desmos 原生行为、实现高度封装和可预测性的基石。

## 1. 依赖管理：禁止悬空依赖

严格禁止任何形式的悬空依赖。一个表达式被创建时，它所依赖的所有符号必须已经定义。

这确保了计算图在任何时候都是完整和确定的，从根本上保证了系统的稳定性和可预测性，简化了后续的分析和计算过程。

## 2. 上下文语句：统一为弱绑定回调模式

为了消除歧义并增强封装性，所有上下文语句（包括原版Desmos中具有强制替换功能的 `with` 和 `for`）都将采用统一的“弱绑定”实现模式。它们只负责为其内部作用域提供局部变量，而不影响任何上游表达式的结构。

推荐的实现语法将采用函数回调的形式，将局部变量通过上下文对象 (`ctx`) 注入：

```javascript
// 'For' 语句创建一个上下文，其中 a=3, b=expr`4`
// 然后将这个上下文作为参数 ctx 传递给回调函数
const c1 = For`a = 3, b = ${expr`4`}` (ctx => {
    // 回调函数返回一个新的表达式，其中使用了上下文提供的 a 和 b
    // ctx.a 和 ctx.b 是表达式对象，可以被直接嵌入
    return expr`${ctx.a}^2 + ${ctx.b}^2`;
});

// 或者解包：
const c2 = For`a = 3, b = ${expr`4`}` (({a, b}) => {
    return expr`${a}^2 + ${b}^2`;
});
```

详见 [上下文语句创建](./上下文语句创建.md)。

这种模式确保了作用域的清晰隔离，上下文的提供方和使用方权责分明，彻底杜绝了 Desmos 中“下游影响上游”的复杂情况，使得代码行为更易于推理和维护。
